<!DOCTYPE html><html><head>
      <title>蓝桥杯单片机备赛宝典</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="前言">前言 </h1>
<p>本文介绍一下蓝桥杯单片机考点，以总结的角度去讲解，对底层不做过多介绍，主要着重于比赛中有所涉及的考法，对底层有疑问可以看底层讲解文章或B站UP主柳离风视频。建议看完提升篇后再着重攻读。内容摘自CSDN柳离风文章（部分更改），若有错误内容请联系助教进行修正。</p>
<div style="page-break-after: always;"></div>
<h1 id="一-数码管相关考点总结">一、数码管相关考点总结 </h1>
<hr>
<h2 id="一数码管控制代码">（一）数码管控制代码 </h2>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">/*数码管底层驱动*/</span>
code uchar segment<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0x3F</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5B</span><span class="token punctuation">,</span><span class="token number">0x4F</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6D</span><span class="token punctuation">,</span><span class="token number">0x7D</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">,</span><span class="token number">0x6F</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">smg</span><span class="token punctuation">(</span>uchar <span class="token operator">*</span> temp<span class="token punctuation">,</span>uchar <span class="token operator">*</span>dot<span class="token punctuation">,</span>uchar pos<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	P0<span class="token operator">=</span><span class="token number">0xff</span><span class="token punctuation">;</span>
	<span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	P0<span class="token operator">=</span><span class="token number">0x01</span><span class="token operator">&lt;&lt;</span>pos<span class="token punctuation">;</span>
	<span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dot<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		P0<span class="token operator">=</span><span class="token operator">~</span>segment<span class="token punctuation">[</span>temp<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   
	<span class="token keyword keyword-else">else</span>
		P0<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">~</span>segment<span class="token punctuation">[</span>temp<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x7f</span><span class="token punctuation">;</span>
	<span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">/*数码管定时器中断当时执行*/</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  interrupt <span class="token number">3</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token operator">==</span><span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		fre<span class="token operator">=</span><span class="token punctuation">(</span>TH0<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">|</span>TL0<span class="token punctuation">;</span>
		TH0<span class="token operator">=</span>TL0<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
	key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
  display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
  collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span>dot<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关键部分</span>
	<span class="token function">led</span><span class="token punctuation">(</span>LED<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">/*数码管主循环中幅值使用*/</span>
SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><div style="page-break-after: always;"></div>
<h2 id="二数码管考点分析">（二）数码管考点分析 </h2>
<hr>
<h3 id="1-显示数字">1. 显示数字 </h3>
<p>以 <code>num = 1234</code> 为例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//先除后取余</span>
SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> num <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="2-显示小数点">2. 显示小数点 </h3>
<p>以显示ADC采样电压，保留两位小数为例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uint adc<span class="token punctuation">;</span>
<span class="token comment">/*定义unsigned int类型，保存不了小数，需要放大100倍，51.0不可以写为51！*/</span>
adc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">PCF8591_read</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">51.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span> 
SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> adc <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> adc <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> adc <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
dot<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="3-显示特殊字符">3. 显示特殊字符 </h3>
<p>最近几年比赛会提供A-F断码，需要自己写的断码有：-、P、n、H、U、L等，以P为例： 开发板上数码管为共阳极数码管，IO口给低电平会点亮。</p>
<center><img src="./smg_image/数码管显示P.png" align="middle"></center>
<p>写成二进制就是 <code>10001100</code>，对应十六进制 <code>0x8c</code>。</p>
<hr>
<h3 id="4-多界面">4. 多界面 </h3>
<center><img src="./smg_image/多界面1.png" align="middle" width="600"></center>
<center><img src="./smg_image/多界面2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>多界面需要定义显示状态码，根据题目分为三个主界面，其中一个主界面分为三个子界面
所以定义一个state_display1<span class="token punctuation">,</span>定义一个state_display2

<span class="token comment">// 定义状态码</span>
uchar state_display1<span class="token punctuation">,</span> state_display2<span class="token punctuation">;</span>

<span class="token comment">// 根据状态码切换显示内容</span>
<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>state_display1<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-case">case</span> <span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>
		<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>state_display2<span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
		    <span class="token keyword keyword-case">case</span> <span class="token number">0</span><span class="token operator">:</span>
		        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		    <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>
		        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		    <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>
		        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		    <span class="token keyword keyword-default">default</span><span class="token operator">:</span>
		        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>
        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-default">default</span><span class="token operator">:</span>
        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5-数码管闪烁">5. 数码管闪烁 </h3>
<p>有两种写法：</p>
<ol>
<li>
<p>用DS1302的秒控制（只能以秒为单位闪烁，并且题目使用了DS1302，否则0分）。</p>
</li>
<li>
<p>用定时器中断产生标志位。</p>
</li>
</ol>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// DS1302写法为例</span>
SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">// 16为-的索引、17为熄灭索引</span>
SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">// 16为-的索引、17为熄灭索引</span>
SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 定时器中断标志为例</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_1000ms <span class="token operator">==</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count_1000ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        flag_flash <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">led</span><span class="token punctuation">(</span>LED<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>flag_flash<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">// 16为-的索引、17为熄灭索引</span>
SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>flag_flash<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">// 16为-的索引、17为熄灭索引</span>
SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="6-高位熄灭">6. 高位熄灭 </h3>
<p>以频率测量为例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> fre <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="7-负数显示">7. 负数显示 </h3>
<center><img src="./smg_image/负数显示.png" align="middle" width="600"></center>
<p>以第十四届国赛为例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-char">char</span> par <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 因为题目同时考到了负数显示及高位熄灭，只能按正负分类讨论，否则嵌套逻辑太复杂</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>par <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 大于0需要高位熄灭</span>
    SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>par <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> par <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>par <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> par <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> par <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>par <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>par <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">16</span> <span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">;</span> <span class="token comment">// 17为熄灭索引，16为-索引</span>
    SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>par <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">16</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">-</span>par<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>par<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="8-单位切换">8. 单位切换 </h3>
<center><img src="./smg_image/单位切换.png" align="middle" width="600"></center>
<p>以第十三届国赛为例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 假设频率为245HZ，那么切换后为0.2KHZ，切换后发现数码管带小数的这位高位不熄灭</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> fre<span class="token punctuation">;</span> <span class="token comment">// 显示六位，已经大于65535了，不能用uint</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> fre_khz<span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mode_fre<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 单位HZ</span>
    SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token comment">// F</span>
    SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">100000</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> fre <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    dot<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span> <span class="token comment">// 单位KHZ</span>
    fre_khz <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 保留几位小数就×10的几次方</span>
    SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token comment">// F</span>
    SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre_khz <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">100000</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre_khz <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">10000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre_khz <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre_khz <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span> fre <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> fre_khz <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 高位不熄灭</span>
    SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> fre_khz <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
    dot<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><center><img src="./smg_image/测距界面.png" align="middle" width="600"></center>
<p>简单分析一下会发现单位为m时只是最高位多了个0，并且小数点位置不变，所以单位为m时高位不熄灭</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar distance<span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mode_distance<span class="token punctuation">)</span><span class="token comment">//单位cm</span>
<span class="token punctuation">{</span>
	SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//A </span>
	SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>distance<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>distance<span class="token operator">/</span><span class="token number">10</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> distance<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	dot<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span><span class="token comment">//单位m</span>
<span class="token punctuation">{</span>
	SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">//A </span>
	SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> distance<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span><span class="token comment">//带小数点高位不熄灭</span>
	SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> distance<span class="token operator">/</span><span class="token number">10</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> distance<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	dot<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>十二届省赛第二场</p>
<center><img src="./smg_image/十二届省赛第二场.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> fre<span class="token punctuation">;</span> <span class="token comment">//七位已经大于65535了，不能用uint</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> T<span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mode_fre<span class="token punctuation">)</span><span class="token comment">//显示频率</span>
<span class="token punctuation">{</span>
	SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token comment">//F </span>
	SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>fre<span class="token operator">/</span><span class="token number">1000000</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>fre<span class="token operator">/</span><span class="token number">100000</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>fre<span class="token operator">/</span><span class="token number">10000</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>fre<span class="token operator">/</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>fre<span class="token operator">/</span><span class="token number">100</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>fre<span class="token operator">/</span><span class="token number">10</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> fre<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span><span class="token comment">//显示周期 T= 1/F,注意单位是us;要×10的6次</span>
<span class="token punctuation">{</span>
	T<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span>fre<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token number">1000000</span><span class="token punctuation">;</span><span class="token comment">//因为要保留小数所以1要变成1.0</span>
	SMG<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span> <span class="token comment">//n</span>
	SMG<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T <span class="token operator">&lt;</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>T<span class="token operator">/</span><span class="token number">1000000</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>T<span class="token operator">/</span><span class="token number">100000</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>T<span class="token operator">/</span><span class="token number">10000</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>T<span class="token operator">/</span><span class="token number">1000</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>T<span class="token operator">/</span><span class="token number">100</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>T <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">17</span> <span class="token operator">:</span>T<span class="token operator">/</span><span class="token number">10</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
	SMG<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> T<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<div style="page-break-after: always;"></div>
<h1 id="二-led相关考点总结">二、LED相关考点总结 </h1>
<hr>
<h2 id="一led控制代码">（一）LED控制代码 </h2>
<p>LED底层代码一共有两种，一种为状态控制版本，一种为直接赋值法，前者适合状态控制，可以实现每个灯互不影响，后者适合流水灯，PWM灯。</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 状态控制版本</span>
<span class="token keyword keyword-void">void</span> <span class="token function">led</span><span class="token punctuation">(</span>uchar <span class="token operator">*</span> LED<span class="token punctuation">,</span> uchar pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> uchar temp <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>LED<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        temp <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x01</span> <span class="token operator">&lt;&lt;</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        temp <span class="token operator">|=</span> <span class="token number">0x01</span> <span class="token operator">&lt;&lt;</span> pos<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    P0 <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
LED<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>col_flag <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> display_state1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>col_flag <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> display_state1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>col_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>count_tri <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> temp <span class="token operator">&gt;</span> temp_par<span class="token punctuation">)</span> <span class="token operator">?</span> L4_state <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>count_tri <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>hum <span class="token operator">&gt;</span> <span class="token number">90</span> <span class="token operator">||</span> hum <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>count_tri <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> L6_state <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 直接赋值法</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_200ms <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count_200ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P0 <span class="token operator">=</span> <span class="token number">0xff</span> <span class="token operator">&lt;&lt;</span> position<span class="token punctuation">;</span>  <span class="token comment">// 整体赋值</span>
        <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>position <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after: always;"></div>
<h2 id="二led考点分析">（二）LED考点分析 </h2>
<hr>
<h3 id="1-流水灯">1. 流水灯 </h3>
<p>以第二届省赛为例：</p>
<center><img src="./led_image/第二届省赛.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_200ms <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count_200ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P0 <span class="token operator">=</span> <span class="token number">0xff</span> <span class="token operator">&lt;&lt;</span> position<span class="token punctuation">;</span>  <span class="token comment">// 整体赋值</span>
        <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>position <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>position <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> position<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span> position <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2-pwm流水灯">2. PWM流水灯 </h3>
<p>以第九届省赛为例：</p>
<center><img src="./led_image/第九届省赛.png" align="middle" width="600"></center>
ledpwm调光的频率大概在100HZ左右，对应时间10ms，题目要求分四个PWM占空比，25%，50%，75%，100%，这样的话需要在2.5ms改变一次LED状态，有点不合理，所以我们将周期改为12ms,频率83HZ。  
需要注意的是LED低电平点亮  
下面以实现25%亮度为例
<center><img src="./led_image/pwmled.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uint count_ms<span class="token punctuation">;</span>
uint mode_time<span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_ms <span class="token operator">==</span> mode_time<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 控制移位</span>
        count_ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>position <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>pwm_count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 等于0点亮LED</span>
        P0 <span class="token operator">=</span> <span class="token number">0xff</span> <span class="token operator">&lt;&lt;</span> position<span class="token punctuation">;</span>  <span class="token comment">// 整体赋值</span>
        <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>pwm_count <span class="token operator">==</span> pwm_duty<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 等于占空比时熄灭</span>
        P0 <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>  <span class="token comment">// 整体赋值</span>
        <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pwm_count <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 加到12归零</span>
        pwm_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="3-led闪烁以x秒为间隔闪烁指的是亮和灭的时间间隔">3. LED闪烁（以x秒为间隔闪烁指的是亮和灭的时间间隔） </h3>
<h4 id="题目一">题目一 </h4>
<center><img src="./led_image/led闪烁.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uint count_ms<span class="token punctuation">;</span>
uint mode_time<span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_ms <span class="token operator">==</span> mode_time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count_ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        L1_flag <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//每隔一段时间取反</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
LED<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> L1_flag<span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><h4 id="题目二">题目二 </h4>
<center><img src="./led_image/led闪烁2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uint count_ms<span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_ms <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count_ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        L8_flag <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//每隔100ms取反</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
LED<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token operator">?</span> L8_flag <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//仅在指定模式下闪烁</span>
</code></pre><hr>
<h3 id="4-led亮一定时间后熄灭">4. LED亮一定时间后熄灭 </h3>
<h4 id="题目一-1">题目一 </h4>
<center><img src="./led_image/led亮一会.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>LED<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//使用ds1302实现</span>
LED<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><h4 id="题目二-1">题目二 </h4>
<center><img src="./led_image/led亮一会2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uint count_ms<span class="token punctuation">;</span>
uchar count<span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count_ms <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            count_ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 亮灭各十次</span>
                count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
LED<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="5-状态指示灯">5. 状态指示灯 </h3>
<center><img src="./led_image/状态指示灯.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>LED<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>vol <span class="token operator">&gt;</span> vol_old<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>fre <span class="token operator">&gt;</span> fre_old<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
LED<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="6-二进制灯">6. 二进制灯 </h3>
<center><img src="./led_image/二进制灯.png" align="middle" width="600"></center>
<center><img src="./led_image/程序员计数器.png" align="middle" width="300"></center>
<p>用程序员计算器计算发现80的二进制为01010000；与LED的显示正好相反，所以需要进行取反</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">3</span> <span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    P0 <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//~（01010000）</span>
    <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<div style="page-break-after: always;"></div>
<h1 id="三-按键考点总结">三、按键考点总结 </h1>
<hr>
<h2 id="一按键底层代码">（一）按键底层代码 </h2>
<p>按键底层一共有两种：独立按键和矩阵键盘。（这里按键消抖使用定时器任务调度来实现）</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>bit key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 独立按键</span>
uchar <span class="token function">key_scan1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P31 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P32 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P31 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P32 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P33 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 矩阵键盘</span>
uchar <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> P35 <span class="token operator">=</span> P34 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    P30 <span class="token operator">=</span> P31 <span class="token operator">=</span> P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P42 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P35 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P34 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P35 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P34 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> P35 <span class="token operator">=</span> P34 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P30 <span class="token operator">=</span> P31 <span class="token operator">=</span> P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P42 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P35 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P34 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S9</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S4</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S8</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after: always;"></div>
<h2 id="二按键触发方式近几年-s4-s5-s8-s9-考频很高就以这四个按键为例">(二)按键触发方式（近几年 S4、S5、S8、S9 考频很高，就以这四个按键为例） </h2>
<hr>
<h3 id="1-按下生效-松手生效">1. 按下生效、松手生效 </h3>
<p>第八届省赛</p>
<center><img src="./key_image/第八届省赛.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> bit S4_flag<span class="token punctuation">;</span>
    uchar key<span class="token punctuation">;</span>
    P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// S4 按下</span>
            S4_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> key<span class="token punctuation">;</span> <span class="token comment">// S4 按下后返回 3</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P42 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S4_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S4_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">40</span><span class="token punctuation">;</span>  <span class="token comment">// S4 按下后的松手</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S9</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S8</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">40</span><span class="token operator">:</span> <span class="token comment">// S4 按下后松手</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2-短按-长按生效">2. 短按、长按生效 </h3>
<p>题目一：</p>
<center><img src="./key_image/短按长按生效1.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//长按短按功能互不影响，所以短按必须放松手判断</span>
uchar <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//S8、S9、S12、S13</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-static">static</span> bit S13_flag<span class="token punctuation">;</span>
	<span class="token keyword keyword-static">static</span> bit S12_flag<span class="token punctuation">;</span>
	<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> key_time<span class="token punctuation">;</span>
	uchar key<span class="token punctuation">;</span>
	P42 <span class="token operator">=</span> P35  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P35 <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>       key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P35 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>  key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span>               <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		P42 <span class="token operator">=</span> P35 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>  key <span class="token operator">=</span> key <span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>  key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//S13按下</span>
		<span class="token punctuation">{</span>
			S13_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  
			key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span> 
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">//S14按下</span>
		<span class="token punctuation">{</span>
			S12_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-return">return</span> key<span class="token punctuation">;</span><span class="token comment">//S4按下后返回3</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P35 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S13_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">)</span>   <span class="token comment">//按下时间小于1s为短按</span>
		<span class="token punctuation">{</span>
			S13_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-return">return</span> <span class="token number">130</span><span class="token punctuation">;</span>  <span class="token comment">//S13短按</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S12_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">)</span>   <span class="token comment">//按下时间小于1s为短按</span>
		<span class="token punctuation">{</span>
			S12_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-return">return</span> <span class="token number">120</span><span class="token punctuation">;</span>  <span class="token comment">//S13短按</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S13_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		S13_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token number">131</span><span class="token punctuation">;</span>  <span class="token comment">//S13长按</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S12_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		S12_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token number">121</span><span class="token punctuation">;</span>  <span class="token comment">//S12长按</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
		uchar key<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_dly<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
		key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>      <span class="token comment">//S9</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span> 
			<span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>    	 
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>    	<span class="token comment">//S8</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>  	 
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">120</span><span class="token operator">:</span>    <span class="token comment">//S12短按</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">121</span><span class="token operator">:</span>    <span class="token comment">//S12长按</span>
			<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">130</span><span class="token operator">:</span>    <span class="token comment">//S13短按</span>
			<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">131</span><span class="token operator">:</span>    <span class="token comment">//S13长按</span>
			<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
		uchar key<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_dly<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
		key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>      <span class="token comment">//S5</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span> 
			<span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>    	 <span class="token comment">//S9</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>    	<span class="token comment">//S4按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>  	 <span class="token comment">//S8</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">40</span><span class="token operator">:</span>    <span class="token comment">//S4按下后松手</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><p>题目二：</p>
<center><img src="./key_image/短按长按生效2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//这个题目并没有规定长按快速加的速度，所以我们规定100ms加0.1V</span>
bit flag_add<span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  interrupt <span class="token number">3</span>
<span class="token punctuation">{</span>
	 systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
	 key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
	 display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
	 collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span>dot<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>flag_add <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>count_100ms <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			count_100ms <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>vol_par <span class="token operator">==</span> <span class="token number">50</span><span class="token punctuation">)</span>
				vol_par <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">led</span><span class="token punctuation">(</span>LED<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
uchar <span class="token function">key_scan1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-long">long</span> key_time<span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P31 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P32 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>          <span class="token keyword keyword-return">return</span> <span class="token number">7</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>     
		<span class="token punctuation">{</span>
			S6_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>     <span class="token keyword keyword-return">return</span> <span class="token number">5</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>     <span class="token keyword keyword-return">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P31 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P32 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P33 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S6_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&lt;=</span> <span class="token number">800</span><span class="token punctuation">)</span>  <span class="token comment">//S6短按</span>
		<span class="token punctuation">{</span>
			S6_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-return">return</span> <span class="token number">6</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S6_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&gt;</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token comment">//S6长按松手</span>
		<span class="token punctuation">{</span>
			S6_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-return">return</span> <span class="token number">61</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>S6_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&gt;</span> <span class="token number">800</span><span class="token punctuation">)</span>  <span class="token comment">//S6长按</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-return">return</span> <span class="token number">60</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
<span class="token comment">//主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
		uchar key<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_dly<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
		key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		key <span class="token operator">=</span> <span class="token function">key_scan1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">7</span><span class="token operator">:</span>      <span class="token comment">//S7</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span> 
			<span class="token keyword keyword-case">case</span> <span class="token number">6</span><span class="token operator">:</span>    	vol_par<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//S6短按 </span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">5</span><span class="token operator">:</span>    	<span class="token comment">//S5</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>  	 <span class="token comment">//S4</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">60</span><span class="token operator">:</span>  flag_add <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//S6长按</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">61</span><span class="token operator">:</span> flag_add <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//S6长按后松手</span>
			<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><hr>
<h3 id="3-双按键">3. 双按键 </h3>
<p>代码如下（示例）：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 以 S8、S9 为例</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> bit S8_flag<span class="token punctuation">;</span>
    <span class="token keyword keyword-static">static</span> bit S9_flag<span class="token punctuation">;</span>
    uchar key<span class="token punctuation">;</span>
    P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// S9 按下</span>
        <span class="token punctuation">{</span>
            key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            S9_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S8_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// S8、S9 同时按下</span>
            <span class="token punctuation">{</span>
                key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                S8_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                S9_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token number">89</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// S8 按下</span>
        <span class="token punctuation">{</span>
            key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            S8_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S9_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// S8、S9 同时按下</span>
            <span class="token punctuation">{</span>
                key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                S8_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                S9_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token number">89</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P42 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S8_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S8_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token comment">// S8 按下后的松手</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S9_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S9_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">90</span><span class="token punctuation">;</span>  <span class="token comment">// S9 按下后的松手</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">80</span><span class="token operator">:</span> <span class="token comment">// S8 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">90</span><span class="token operator">:</span> <span class="token comment">// S9 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">89</span><span class="token operator">:</span> <span class="token comment">// S9、S9 都按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="4-双击">4. 双击 </h3>
<p>双击按键在第十五届蓝桥杯之前还未考过，但十五届考纲出现双击，可能国赛会考，双击与单击的区别就是第一次按下后一定时间内有无二次按下，这里取时间间隔为500ms</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// S4 双击为例</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S4_state<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S4_state <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>systick_ms <span class="token operator">-</span> key_time <span class="token operator">&lt;=</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 双击 S4</span>
            <span class="token punctuation">{</span>
                S4_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-return">return</span> <span class="token number">40</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P42 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S4_state <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>systick_ms <span class="token operator">-</span> key_time<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token comment">// 单击 S4</span>
        <span class="token punctuation">{</span>
            S4_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">41</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S9</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S8</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">40</span><span class="token operator">:</span> <span class="token comment">// S4 双击</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">41</span><span class="token operator">:</span> <span class="token comment">// S4 单击</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5-组合按键根据排列组合大概有二十一种组合方式一定要灵活使用">5. 组合按键（根据排列组合，大概有二十一种组合方式，一定要灵活使用） </h3>
<h4 id="1短按和长按松手">（1）短按和长按松手 </h4>
<center><img src="./key_image/组合按键1.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar <span class="token function">key_scan1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> bit S7_state<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P31 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P32 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S7_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P31 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P30 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P31 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P32 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P33 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S7_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 短按 S7</span>
        <span class="token punctuation">{</span>
            S7_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">70</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S7_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> systick_ms <span class="token operator">-</span> key_time <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 长按 S7 超过 1s 后松手</span>
        <span class="token punctuation">{</span>
            S7_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">71</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S6</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S5</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S4</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">70</span><span class="token operator">:</span> <span class="token comment">// S7 短按</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">71</span><span class="token operator">:</span> <span class="token comment">// S7 长按超过 1s 后松手</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2双按键长按">（2）双按键长按 </h4>
<p>第十四届国赛</p>
<center><img src="./key_image/组合按键2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 以 S8、S9 为例</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> bit S8_flag<span class="token punctuation">;</span>
    <span class="token keyword keyword-static">static</span> bit S9_flag<span class="token punctuation">;</span>
    uchar key<span class="token punctuation">;</span>
    P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_up <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P42 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P44 <span class="token operator">=</span> P42 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        P32 <span class="token operator">=</span> P33 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> key <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// S9 按下</span>
        <span class="token punctuation">{</span>
            key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            S9_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S8_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// S8、S9 同时按下</span>
            <span class="token punctuation">{</span>
                key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span> <span class="token comment">// 开始计时</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// S8 按下</span>
        <span class="token punctuation">{</span>
            key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            S8_flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S9_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// S8、S9 同时按下</span>
            <span class="token punctuation">{</span>
                key_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                key_time <span class="token operator">=</span> systick_ms<span class="token punctuation">;</span> <span class="token comment">// 开始计时</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>P44 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> P42 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        key_up <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S8_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S8_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token comment">// S8 按下后的松手</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>S9_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            S9_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">90</span><span class="token punctuation">;</span>  <span class="token comment">// S9 按下后的松手</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>systick_ms <span class="token operator">-</span> key_time <span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>P32 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> P33 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>S8_flag <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> S9_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// S8、S9 都按下并按下持续时间超过 2 秒</span>
    <span class="token punctuation">{</span>
        S8_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        S9_flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">89</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">80</span><span class="token operator">:</span> <span class="token comment">// S8 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">90</span><span class="token operator">:</span> <span class="token comment">// S9 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">89</span><span class="token operator">:</span> <span class="token comment">// S9、S9 都按下并持续时间超过 2 秒</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after: always;"></div>
<h2 id="三按键功能">（三）按键功能 </h2>
<hr>
<h3 id="1-状态切换">1. 状态切换 </h3>
<p>第十四届省赛</p>
<center><img src="./key_image/按键功能1.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar state_display1<span class="token punctuation">,</span> state_display2<span class="token punctuation">;</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 切记注意界面约束和参数边界值</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 回显界面</span>
                display_state2 <span class="token operator">=</span> <span class="token punctuation">(</span>display_state2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S4</span>
            display_state1 <span class="token operator">=</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> display_state2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2-参数调整">2. 参数调整 </h3>
<h4 id="1是否退出参数界面生效题目一定会说明不说明就默认设置时生效">（1）是否退出参数界面生效(题目一定会说明，不说明就默认设置时生效) </h4>
<p>第十三届省赛第二场</p>
<center><img src="./key_image/按键功能2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar state_display<span class="token punctuation">;</span> <span class="token comment">// 0: 电压界面  1: 测距界面  2: 参数界面</span>
bit state_par<span class="token punctuation">;</span>       <span class="token comment">// 0: 上限参数  1: 下限参数</span>
uchar vol_par_max<span class="token punctuation">,</span> vol_display1<span class="token punctuation">;</span> <span class="token comment">// 参数上限和显示参数上限</span>
uchar vol_par_min<span class="token punctuation">,</span> vol_display2<span class="token punctuation">;</span> <span class="token comment">// 参数下限和显示参数下限</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S7 按下  减 0.5</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> state_par <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 参数界面且上限参数</span>
            <span class="token punctuation">{</span>
                vol_display1 <span class="token operator">=</span> <span class="token punctuation">(</span>vol_display1 <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vol_display1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> vol_display1 <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> state_par <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 参数界面且上限参数</span>
            <span class="token punctuation">{</span>
                vol_display2 <span class="token operator">=</span> <span class="token punctuation">(</span>vol_display2 <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vol_display2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> vol_display2 <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S6 按下  加 0.5</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> state_par <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 参数界面且上限参数</span>
            <span class="token punctuation">{</span>
                vol_display1 <span class="token operator">=</span> <span class="token punctuation">(</span>vol_display1 <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vol_display1 <span class="token operator">==</span> <span class="token number">55</span><span class="token punctuation">)</span> vol_display1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> state_par <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 参数界面且上限参数</span>
            <span class="token punctuation">{</span>
                vol_display2 <span class="token operator">=</span> <span class="token punctuation">(</span>vol_display2 <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vol_display2 <span class="token operator">==</span> <span class="token number">55</span><span class="token punctuation">)</span> vol_display2 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S5 按下</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
                state_par <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            state_display <span class="token operator">=</span> <span class="token punctuation">(</span>state_display <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 从参数界面退出时参数生效</span>
            <span class="token punctuation">{</span>
                vol_par_max <span class="token operator">=</span> vol_display1<span class="token punctuation">;</span>
                vol_par_min <span class="token operator">=</span> vol_display2<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2边界值限制题目一定会说明不说明就默认参数加-减到最值时不会再加-减">（2）边界值限制(题目一定会说明，不说明就默认参数加、减到最值时不会再加、减) </h4>
<p>第十一届省赛第二场</p>
<center><img src="./key_image/按键功能3.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar state_display<span class="token punctuation">;</span> <span class="token comment">// 0: 数据界面  1: 参数界面  2: 计数界面</span>

<span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S13 按下</span>
            count_tri <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S17 按下</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vol_par <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    vol_par <span class="token operator">=</span> <span class="token number">55</span><span class="token punctuation">;</span>
                vol_par <span class="token operator">=</span> <span class="token punctuation">(</span>vol_par <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S12 按下</span>
            state_display <span class="token operator">=</span> <span class="token punctuation">(</span>state_display <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S16 按下</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state_display <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                vol_par <span class="token operator">=</span> <span class="token punctuation">(</span>vol_par <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vol_par <span class="token operator">==</span> <span class="token number">55</span><span class="token punctuation">)</span>
                    vol_par <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="3检查参数合理性">（3）检查参数合理性 </h4>
<p>第十一届省赛第一场</p>
<center><img src="./key_image/按键功能4.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar T_max<span class="token punctuation">,</span>T_min<span class="token punctuation">;</span>
<span class="token comment">//主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
		uchar key<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_dly<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
		key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>      <span class="token comment">//S7按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span> 
			<span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>    	<span class="token comment">//S6按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>  	 <span class="token comment">//S5按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>  	 <span class="token comment">//S4按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h4 id="4参数非线性调节">（4）参数非线性调节 </h4>
<p>第十二届国赛</p>
<center><img src="./key_image/按键功能5.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>code uchar col_time_display<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
code uchar dis_par_display<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
uchar col_time<span class="token punctuation">;</span>
uchar dis_par<span class="token punctuation">;</span>
<span class="token comment">//主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
		uchar key<span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>key_dly<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
		key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>      <span class="token comment">//S5按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span> 
			<span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>    	<span class="token comment">//S4按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">80</span><span class="token operator">:</span>  	 <span class="token comment">//S8按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">90</span><span class="token operator">:</span>  	 <span class="token comment">//S9按下</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">89</span><span class="token operator">:</span>    <span class="token comment">//S9、S9都按下并持续时间超过2秒</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="3-多界面">3. 多界面 </h3>
<p>第十四届国赛</p>
<center><img src="./key_image/按键功能6.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S8 按下</span>
            <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>state_display<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S9 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="4-切换选中单元">4. 切换选中单元 </h3>
<p>第八届省赛</p>
<center><img src="./key_image/按键功能7.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S7 按下</span>
            index <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// 然后在显示中判断哪个数码管闪烁</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S6 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S5 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5-键盘输入">5. 键盘输入 </h3>
<p>第六届省赛</p>
<center><img src="./key_image/按键功能8.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">5</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">6</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">7</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">8</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">9</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">10</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">11</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">12</span><span class="token operator">:</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="6-按键禁用">6. 按键禁用 </h3>
<p>第十四届省赛</p>
<center><img src="./key_image/按键功能9.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 切记注意界面约束和参数边界值</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>col_flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 温湿度界面禁用所有按键</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S5</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 回显界面</span>
                display_state2 <span class="token operator">=</span> <span class="token punctuation">(</span>display_state2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">20</span><span class="token operator">:</span> <span class="token comment">// S9</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 参数界面</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>temp_par <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    temp_par<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S4</span>
            display_state1 <span class="token operator">=</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> display_state2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S8</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state1 <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 参数界面</span>
            <span class="token punctuation">{</span>
                temp_par<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>temp_par <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span>
                    temp_par <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">21</span><span class="token operator">:</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>display_state2 <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                count_tri <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                Time_tri<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                Time_tri<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                temp_max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                hum_max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                temp_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                hum_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                hum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="7-任意按键生效">7. 任意按键生效 </h3>
<p>第八届省赛</p>
<center><img src="./key_image/按键功能10.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 主函数中的按键处理任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    uchar key<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key_dly <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    key_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    key <span class="token operator">=</span> <span class="token function">key_scan2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>key <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> state_alarm <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 在闹钟提示状态，所有按键生效，且不执行按键原有功能</span>
    <span class="token punctuation">{</span>
        state_alarm <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// S7 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// S6 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// S5 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// S4 按下</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<div style="page-break-after: always;"></div>
<h1 id="四-蜂鸣器-继电器-电机考点总结">四、蜂鸣器、继电器、电机考点总结 </h1>
<hr>
<h2 id="一继电器蜂鸣器电机底层代码">（一）继电器蜂鸣器电机底层代码 </h2>
<center><img src="./relaybeepmoter_image/底层代码配图.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">relay</span><span class="token punctuation">(</span>uchar state_relay<span class="token punctuation">)</span><span class="token comment">//继电器</span>
<span class="token punctuation">{</span>
    uchar temp<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span>
        temp <span class="token operator">|=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span>
        temp <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x10</span><span class="token punctuation">;</span>
    P0<span class="token operator">=</span>temp<span class="token punctuation">;</span>
    <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">beep</span><span class="token punctuation">(</span>uchar state_beep<span class="token punctuation">)</span><span class="token comment">//蜂鸣器</span>
<span class="token punctuation">{</span>
    uchar temp<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>state_beep<span class="token punctuation">)</span>
        temp <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span>
        temp <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span>
    P0<span class="token operator">=</span>temp<span class="token punctuation">;</span>
    <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">motor</span><span class="token punctuation">(</span>uchar state_motor<span class="token punctuation">)</span><span class="token comment">//电机</span>
<span class="token punctuation">{</span>
    uchar temp<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>state_motor<span class="token punctuation">)</span>
        temp <span class="token operator">|=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span>
        temp <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x20</span><span class="token punctuation">;</span>
    P0<span class="token operator">=</span>temp<span class="token punctuation">;</span>
    <span class="token function">hc573</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after: always;"></div>
<h2 id="二考点分析前两者考点均为状态控制电机为pwm">（二）考点分析（前两者考点均为状态控制，电机为PWM） </h2>
<hr>
<h3 id="1-继电器">1. 继电器 </h3>
<p>继电器最近几年还是常考考点之一，希望一定掌握。</p>
<p>第十三届省赛第一场</p>
<center><img src="./relaybeepmoter_image/继电器.png" align="middle" width="600"></center>
<p>代码如下（示例）：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 采集任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    temp <span class="token operator">=</span> <span class="token function">ds18b20_read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ds1302_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        state_relay <span class="token operator">=</span> <span class="token punctuation">(</span>temp <span class="token operator">&gt;</span> temp_par<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        state_relay <span class="token operator">=</span> <span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  interrupt <span class="token number">3</span>
<span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">led</span><span class="token punctuation">(</span>LED<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 继电器控制</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2-蜂鸣器">2. 蜂鸣器 </h3>
<p>蜂鸣器已经快十年没考过了，可能是他的报警功能可以用 LED 替代，而蜂鸣器在比赛时非常刺耳影响考生心态，所以以后考的概率也很低。<br>
第四届省赛</p>
<center><img src="./relaybeepmoter_image/蜂鸣器.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    hum <span class="token operator">=</span> <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.57</span><span class="token punctuation">;</span>
    state_beep <span class="token operator">=</span> <span class="token punctuation">(</span>hum <span class="token operator">&gt;</span> hum_par <span class="token operator">&amp;&amp;</span> mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  interrupt <span class="token number">3</span>
<span class="token punctuation">{</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span> dot<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">led</span><span class="token punctuation">(</span>LED<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">beep</span><span class="token punctuation">(</span>state_beep<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 蜂鸣器控制</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="3-电机">3. 电机 </h3>
<p>电机出考点一般都会用 PWM，第十三届国赛是唯一考过电机的题目（这个题目有点问题，因为电机引脚用的 P0，必须和 LED 数码管蜂鸣器继电器放一块，否则会互相干扰）。</p>
<center><img src="./relaybeepmoter_image/电机.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">Timer2Init</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>    <span class="token comment">// 100 微秒 @12.000MHz</span>
<span class="token punctuation">{</span>
    AUXR <span class="token operator">|=</span> <span class="token number">0x04</span><span class="token punctuation">;</span>        <span class="token comment">// 定时器时钟 1T 模式</span>
    T2L <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span>          <span class="token comment">// 设置定时初值</span>
    T2H <span class="token operator">=</span> <span class="token number">0xFB</span><span class="token punctuation">;</span>          <span class="token comment">// 设置定时初值</span>
    AUXR <span class="token operator">|=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>        <span class="token comment">// 定时器 2 开始计时</span>
    IE2 <span class="token operator">|=</span> <span class="token number">0x04</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">timer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   interrupt <span class="token number">12</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>count_pwm <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">motor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>count_pwm <span class="token operator">==</span> pwm_duty<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">motor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>count_pwm <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span>
        pwm_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<div style="page-break-after: always;"></div>
<h1 id="五-采集任务考点总结">五、采集任务考点总结 </h1>
<hr>
<h2 id="一采集模块总结">（一）采集模块总结 </h2>
<hr>
<h3 id="1ds18b20">1.ds18b20 </h3>
<p><strong>重要提示：</strong> 中断里代码尽可能少，DS18B20通信时序十分容易被打断了，中断里以后不要对<code>unsigned long</code>类型的变量<code>%</code>，用时很久。</p>
<p>程序总体框架：</p>
<center><img src="./gather_image/ds13b20_1.png" align="middle" width="600"></center>
<p>具体指令：</p>
<ol>
<li>跳过ROM</li>
</ol>
<center><img src="./gather_image/ds13b20_2.png" align="middle" width="600"></center>
<ol start="2">
<li>温度转换指令</li>
</ol>
<center><img src="./gather_image/ds13b20_3.png" align="middle" width="600"></center>
<ol start="3">
<li>温度读取指令</li>
</ol>
<center><img src="./gather_image/ds13b20_4.png" align="middle" width="600"></center>
<p>注意事项：</p>
<blockquote>
<img src="./gather_image/ds13b20_5.png" align="middle" width="600">
<p>上电读的温度寄存器里的值是85。<br>
<img src="./gather_image/ds13b20_5.png" align="middle" width="600"></p>
<p>温度转换的最大时间是750ms。<br>
上电第一次读到的温度一定是85摄氏度。</p>
</blockquote>
<p>为了不影响参数判断，上电必须开始温度转换，并且到下次采集温度的时间间隔一定要至少750ms，如果上电第一个界面就显示温度的话，一定要先开启转换，delay_ms(750)，再开EA，另外col_dly初始化设置的值大一点，保证第一次采集比显示快，这样显示的第一个温度为正常温度</p>
<p>如果上电第一个界面不是温度，就没必要delay_ms(750)，但最开始还是需要转换一次。</p>
<p>代码示例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//函数名称：uint rd_temperature(uchar dot)</span>
<span class="token comment">//函数功能：读取ds18b20检测到的温度</span>
<span class="token comment">//入口参数：dot (0:保留0位小数   1: 保留一位小数   2:保留两位小数)</span>
<span class="token comment">//出口参数：temp (温度值)</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">rd_temperature</span><span class="token punctuation">(</span>uchar dot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint temp<span class="token punctuation">;</span>
    uchar tml<span class="token punctuation">,</span> tmh<span class="token punctuation">;</span>
    <span class="token function">init_ds18b20</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Write_DS18B20</span><span class="token punctuation">(</span><span class="token number">0xcc</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//跳过ROM</span>
    <span class="token function">Write_DS18B20</span><span class="token punctuation">(</span><span class="token number">0x44</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//温度转换</span>

    <span class="token function">init_ds18b20</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Write_DS18B20</span><span class="token punctuation">(</span><span class="token number">0xcc</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//跳过ROM</span>
    <span class="token function">Write_DS18B20</span><span class="token punctuation">(</span><span class="token number">0xbe</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//温度读取</span>

    tml <span class="token operator">=</span> <span class="token function">Read_DS18B20</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//先读第八位</span>
    tmh <span class="token operator">=</span> <span class="token function">Read_DS18B20</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//再读高八位</span>
    temp <span class="token operator">=</span> <span class="token punctuation">(</span>tmh <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> tml<span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span><span class="token punctuation">(</span>dot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">0</span> <span class="token operator">:</span>   temp <span class="token operator">=</span> temp <span class="token operator">*</span> <span class="token number">0.0625</span><span class="token punctuation">;</span><span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>  <span class="token comment">//不保留小数</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span> <span class="token operator">:</span>   temp <span class="token operator">=</span> temp <span class="token operator">*</span> <span class="token number">0.625</span><span class="token punctuation">;</span><span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>   <span class="token comment">//保留一位小数</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span> <span class="token operator">:</span>   temp <span class="token operator">=</span> temp <span class="token operator">*</span> <span class="token number">6.25</span><span class="token punctuation">;</span><span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>    <span class="token comment">//保留两位小数</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//如果开机界面显示温度需要上电读取一次后延时至少750ms</span>
<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">system_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rd_temperature</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">key_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">display_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2ds1302">2.ds1302 </h3>
<p>看手册把读写的地址写出来（头顶横杠代表低电平有效，否则高电平有效）</p>
<center><img src="./gather_image/ds1302_1.png" align="middle" width="600"></center>
<center><img src="./gather_image/ds1302_2.png" align="middle" width="600"></center>
<p>**注意事项：**如果想用十二小时制，需要注意第三行地址和数据，例如你要往进写上午八点，bit7就是1，bit5就是0，整体是10001000，对应BCD码是0x88,写进去就可以了。注意读的时候不能和之前一样，需要把bit7，bit5分别归零 ，再对16做除法和取余数。</p>
<p>代码示例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>code uchar write_addr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x82</span><span class="token punctuation">,</span><span class="token number">0x84</span><span class="token punctuation">,</span><span class="token number">0x86</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x8a</span><span class="token punctuation">,</span><span class="token number">0x8c</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">//写地址</span>
code uchar read_addr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0x83</span><span class="token punctuation">,</span><span class="token number">0x85</span><span class="token punctuation">,</span><span class="token number">0x87</span><span class="token punctuation">,</span><span class="token number">0x89</span><span class="token punctuation">,</span><span class="token number">0x8b</span><span class="token punctuation">,</span><span class="token number">0x8d</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">//读地址</span>
uchar Time<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x26</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x12</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x23</span><span class="token punctuation">}</span><span class="token punctuation">;</span>              <span class="token comment">//实时时间(用到几个写几个)</span>

<span class="token comment">//函数名称：void ds1302_init()</span>
<span class="token comment">//函数功能：初始化时间数据</span>
<span class="token comment">//入口参数：无</span>
<span class="token comment">//出口参数：无</span>
<span class="token keyword keyword-void">void</span> <span class="token function">ds1302_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uchar i<span class="token punctuation">;</span>
    <span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token comment">//这里的i也是用到几个写几个，否则时钟会乱跑</span>
    <span class="token punctuation">{</span>
        <span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span>write_addr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>Time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Write_Ds1302_Byte</span><span class="token punctuation">(</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//函数名称：void ds1302_read()</span>
<span class="token comment">//函数功能：读取时间数据</span>
<span class="token comment">//入口参数：无</span>
<span class="token comment">//出口参数：无</span>
<span class="token keyword keyword-void">void</span> <span class="token function">ds1302_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uchar i<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">//这里的i也是用到几个写几个，否则时钟会乱跑</span>
    <span class="token punctuation">{</span>
        Time<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Read_Ds1302_Byte</span><span class="token punctuation">(</span>read_addr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="3ne555">3.NE555 </h3>
<p>NE555模块是纯硬件设计，无需底层驱动。通过调节滑动变阻器Rb3可改变输出信号频率。</p>
<p><strong>测量原理</strong><br>
测量频率即计算1秒内信号的上升沿数量：1秒内有X个上升沿，频率为XHz。<br>
<strong>硬件连接</strong>：<br>
用跳线帽将J3的SIGNAL与P34短接，NE555信号输入到单片机P34引脚（T0）。<br>
调节Rb3改变信号频率。</p>
<p><strong>测量频率具体实现</strong>：<br>
使用定时器实现计时和计数功能。<br>
一个中断用于计时（任务调度定时器定时1s）。<br>
一个用于计脉冲个数（输入捕获）。</p>
<p>**注意事项：**P34引脚还是按键的输入引脚之一（ne555和按键模块产生冲突，只能不操作不读取P34引脚避免干扰）。</p>
<p>代码示例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">Timer0Init_Count</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>		<span class="token comment">//计数模式</span>
<span class="token punctuation">{</span>
    TMOD <span class="token operator">&amp;=</span> <span class="token number">0xF0</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时器模式</span>
    TMOD <span class="token operator">|=</span> <span class="token number">0x05</span><span class="token punctuation">;</span>   <span class="token comment">//16位不自动重装</span>
    TL0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
    TH0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
    TF0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">//清除TF0标志</span>
    TR0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>		<span class="token comment">//定时器0开始计数</span>
    <span class="token comment">//一定不要开中断即ET0 = 1;  切记 切记 切记</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">timer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  interrupt <span class="token number">3</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token operator">==</span><span class="token number">1000</span><span class="token punctuation">)</span>   <span class="token comment">//1秒算一次频率</span>
    <span class="token punctuation">{</span>
        fre<span class="token operator">=</span><span class="token punctuation">(</span>TH0<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">|</span>TL0<span class="token punctuation">;</span>
        TH0<span class="token operator">=</span>TL0<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    systick_ms<span class="token operator">++</span><span class="token punctuation">;</span>
    key_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    display_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    collect_dly<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">smg</span><span class="token punctuation">(</span>SMG<span class="token punctuation">,</span>dot<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">led</span><span class="token punctuation">(</span>LED<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">++</span>pos <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">relay</span><span class="token punctuation">(</span>state_relay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="4pcf8591">4.PCF8591 </h3>
<center><img src="./gather_image/pcf8591.png" align="middle" width="600"></center>
<center><img src="./gather_image/pcf8591_2.png" align="middle" width="600"></center>
<table style="width: 80%; margin: 0 auto;">
  <tbody><tr>
    <th>位</th>
    <th>值</th>
    <th>复位值</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>7</td>
    <td>0</td>
    <td>特征位</td>
    <td>固定值为：0。</td>
  </tr>
  <tr>
    <td>6</td>
    <td>X</td>
    <td>模拟输出控制</td>
    <td>0: A/D 转换<br>1: D/A 转换</td>
  </tr>
  <tr>
    <td>5、4</td>
    <td>XX</td>
    <td>模拟量输入方式选择</td>
    <td>00: 四路单端输入<br>01: 三路差分输入<br>10: 两路单端，一路差分<br>11: 两路差分输入</td>
  </tr>
  <tr>
    <td>3</td>
    <td>0</td>
    <td>特征位</td>
    <td>固定值为：0。</td>
  </tr>
  <tr>
    <td>2</td>
    <td>X</td>
    <td>自动增量控制</td>
    <td>0: 禁止自动增量<br>1: 允许自动增量</td>
  </tr>
  <tr>
    <td>1、0</td>
    <td>XX</td>
    <td>A/D 通道选择</td>
    <td>00: AIN0，通道 0<br>01: AIN1，通道 1<br>10: AIN2，通道 2<br>11: AIN3，通道 3</td>
  </tr>
</tbody></table>
<p>根据表格和电路连接可以得知模拟量输入方式为四路单端输入模式，则D4、D5位是00，D2位不使用增益则为0，此时只使用ad功能的情况下应该写入<mark>0000 00XX（0X）</mark>（XX取决于需要读取的输入通道），若使用da则只需要将D6位写1即写入<mark>0100 00XX（4X）</mark>。</p>
<p><strong>注意事项：</strong></p>
<ol>
<li>蓝桥杯板子上的pcf8591使用了四路单端输入，只会考使用AIN0作为DAC输出。</li>
<li>ADC上电初值是<code>0x80</code>，并且ADC读取的值是上次转换后的值，所以当多通道ADC读取时就会出现两个通道数据相反，解决办法就是每个通道各读两遍。</li>
</ol>
<p><strong>提示：</strong> 测电压时用万用表，调到电压档，红表笔接<code>D/A</code>，黑表笔接<code>GND</code>。</p>
<h4 id="adc">ADC </h4>
<center><img src="./gather_image/adc.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//函数名称：uchar PCF8591_Read(uchar control)</span>
<span class="token comment">//函数功能：PCF8591 AD输入读取输入</span>
<span class="token comment">//入口参数：control(控制字)</span>
<span class="token comment">//出口参数：dat(数据)</span>
uchar <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span>uchar control<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uchar dat<span class="token punctuation">;</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>control<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dat <span class="token operator">=</span> <span class="token function">IIC_RecByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendAck</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> dat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="dac">DAC </h4>
<center><img src="./gather_image/dac.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//函数名称：void PCF8591_Write(uchar control,dat)</span>
<span class="token comment">//函数功能：PCF8591 DA输出电压</span>
<span class="token comment">//入口参数：control(控制字)     dat(数据)</span>
<span class="token comment">//出口参数：无</span>
<span class="token keyword keyword-void">void</span> <span class="token function">PCF8591_Write</span><span class="token punctuation">(</span>uchar control<span class="token punctuation">,</span>dat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>control<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="5超声波">5.超声波 </h3>
<center><img src="./gather_image/超声波原理.png" align="middle" width="600"></center>
<p>图片仅粗略展示原理<br>
<strong>超声波主要使用CX20106A接收</strong><br>
这是一款常用的红外线检波接收专用芯片。由于其内部结构和性能特点，它也可以被用于超声波接收处理电路。在超声波测距系统中，当CX20106A接收到40kHz的信号时，会在其第7脚产生一个低电平下降脉冲（了解一下）。</p>
<p><strong>发波接收注意事项</strong></p>
<blockquote>
<p><strong>频率选择</strong>：40kHz是超声波传感器常用的频率之一，主要原因是这个频率的超声波在空气中的传播特性较好，能量损耗较小，且能够有效避免环境噪声的干扰。</p>
<p><strong>50%占空比的意义</strong>：50%占空比的方波信号意味着高电平和低电平的时间相等，这种信号形式简单且易于生成和处理。同时，它能够保证超声波发射器在发射和休息之间有足够的时间间隔，避免信号叠加和干扰。</p>
<p><strong>发波个数的考究</strong>：一般情况下我们选择发送5-8个周期的波形，发送多个周期的超声波信号可以增强信号的强度和稳定性，提高接收端的检测概率。通过发送一定数量的信号并计算信号往返的时间差，可以更准确地计算出距离。但是发波个数过多会增加系统的响应时间，因此需要根据实际应用需求进行平衡。</p>
</blockquote>
<p><strong>代码思路</strong>：发送频率<mark>40Khz</mark>（接近即可），占空比<mark>50%<mark>的</mark>5-8个</mark>周期方波，再利用定时器计时等待接收到信号或者超时。由于比赛的时候可能会NE555和超声波一起考，我们将超声波使用PCA定时器来实现。</p>
<p><strong>提示：</strong> 两个跳线帽都要接好。</p>
<p>代码示例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ultrasonic.h"</span></span>
sbit TX <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>  					<span class="token comment">// 发射引脚</span>
sbit RX <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  					<span class="token comment">// 接收引脚</span>

uchar <span class="token function">read_distance</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  uchar distance<span class="token punctuation">,</span>num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  TX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  CL <span class="token operator">=</span> <span class="token number">0xF3</span><span class="token punctuation">;</span>						<span class="token comment">// 设置定时初值</span>
  CH <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>						<span class="token comment">// 设置定时初值</span>
  CR <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>							<span class="token comment">// 定时器0计时</span>
  <span class="token comment">// TX引脚发送40KHz方波信号驱动超声波发送探头</span>
  <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>num<span class="token operator">--</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span>CF<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TX <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		CL <span class="token operator">=</span> <span class="token number">0xF3</span><span class="token punctuation">;</span>						<span class="token comment">// 设置定时初值</span>
		CH <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>						<span class="token comment">// 设置定时初值</span>
    CF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  CR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  CL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>							<span class="token comment">// 设置定时初值</span>
  CH <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>							<span class="token comment">// 设置定时初值</span>
  CR <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>RX <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>CF<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 等待收到脉冲</span>
  CR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>CF<span class="token punctuation">)</span>							<span class="token comment">// 发生溢出</span>
  <span class="token punctuation">{</span>
    CF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    distance <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword keyword-else">else</span>							    <span class="token comment">// 计算距离</span>
    distance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>CH<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span>CL<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.017</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> distance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p>此处提供一版考试考到声波传播速度会改变的情况下的代码<br>
<strong>提示：</strong> 此处是助教写的，代码风格和老师有出入。</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ultrasonic.h"</span></span>

sbit TX <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>  					<span class="token comment">// 发射引脚</span>
sbit RX <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  					<span class="token comment">// 接收引脚</span>

uint speed <span class="token operator">=</span> <span class="token number">340</span><span class="token punctuation">;</span>                   <span class="token comment">// 超声波速度（单位：米/秒）</span>

<span class="token comment">// 函数：读取超声波测距模块的距离（单位：厘米）</span>
uchar <span class="token function">read_distance</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uint time<span class="token punctuation">;</span>                      <span class="token comment">// 用于存储超声波往返时间（单位：微秒）</span>
    uchar num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                 <span class="token comment">// 发射超声波的周期个数（此处发5个）</span>

    <span class="token comment">// 初始化发射引脚和定时器</span>
    TX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                         <span class="token comment">// 将发射引脚置低</span>
    CR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                         <span class="token comment">// 关闭定时器</span>
    CL <span class="token operator">=</span> <span class="token number">0xf3</span><span class="token punctuation">;</span>                      <span class="token comment">// 设置初值（低8位，可改f2）</span>
    CH <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>                      <span class="token comment">// 设置定时器初值（高8位）</span>
    CR <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                         <span class="token comment">// 启动定时器</span>
    EA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                         <span class="token comment">// 关闭总中断（避免中断干扰发波非必要不写）</span>

    <span class="token comment">// 发送5个周期超声波信号</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>num<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>CF<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 等待定时器溢出（12us左右）</span>
        TX <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token comment">// 改变发射引脚状态，发送超声波</span>
        CR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                     <span class="token comment">// 关闭定时器</span>
        CL <span class="token operator">=</span> <span class="token number">0xf3</span><span class="token punctuation">;</span>                  <span class="token comment">// 重新设置定时器初值（低8位，可改f2）</span>
        CH <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>                  <span class="token comment">// 重新设置定时器初值（高8位）</span>
        CR <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                     <span class="token comment">// 启动定时器</span>
        CF <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                     <span class="token comment">// 清除定时器溢出标志</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 准备接收超声波信号</span>
    EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                         <span class="token comment">// 开启总中断（非必要不写）</span>
    CR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                         <span class="token comment">// 关闭定时器</span>
    CH <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                         <span class="token comment">// 设置定时器初值（高8位）</span>
    CL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                         <span class="token comment">// 设置定时器初值（低8位）</span>
    CR <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                         <span class="token comment">// 启动定时器</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>CH <span class="token operator">&lt;</span> <span class="token number">0x6b</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> RX<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 等待接收超声波或定时器到0x6b（基本足够用了）</span>

    <span class="token comment">// 判断是否接收到超声波信号</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>CH <span class="token operator">&lt;</span> <span class="token number">0x6b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        time <span class="token operator">=</span> CH <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> CL<span class="token punctuation">;</span>        <span class="token comment">// 读取定时器值（往返时间，单位：微秒）</span>

        <span class="token comment">// 计算距离</span>
        <span class="token comment">// 公式：距离 = 时间 × 速度 / 2</span>
        <span class="token comment">// 时间单位为微秒，速度单位为米/秒</span>
        <span class="token comment">// 为了简化计算，公式被改写为：</span>
        <span class="token comment">// 距离 = 时间 × (速度 / 20000.0)</span>
        <span class="token comment">// 其中，20000.0是因为简化公式将speed的单位化为厘米每微妙（cm/us）</span>
        <span class="token comment">//则 1m/s*100 = 100 cm/s = 100cm/s / 1000 000 = 0.0001 cm/us</span>
	    <span class="token comment">//speed * 0.0001 等价于 speed / 10000.0</span>
	    <span class="token comment">//因为time是往返总时长故除2，则总除于20000.0</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>time <span class="token operator">*</span> <span class="token punctuation">(</span>speed <span class="token operator">/</span> <span class="token number">20000.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 返回距离（单位：厘米）</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">255</span><span class="token punctuation">;</span>                   <span class="token comment">// 如果未接收到超声波，返回255</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="6at24c02">6.AT24C02 </h3>
<center><img src="./gather_image/eeprom1.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom2.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom3.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom4.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom5.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom6.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom7.png" align="middle" width="600"></center>
<center><img src="./gather_image/eeprom8.png" align="middle" width="600"></center>
<p>代码示例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//函数名称：void AT24C02_Write(uchar addr,dat)</span>
<span class="token comment">//函数功能：AT24C02字节写</span>
<span class="token comment">//入口参数：addr(地址)      dat(数据)</span>
<span class="token comment">//出口参数：无</span>
<span class="token keyword keyword-void">void</span> <span class="token function">AT24C02_Write</span><span class="token punctuation">(</span>uchar addr<span class="token punctuation">,</span>dat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//函数名称：void AT24C02_Write_Page(uchar * buf,uchar addr,uchar num)</span>
<span class="token comment">//函数功能：AT24C02页写</span>
<span class="token comment">//入口参数：buf(指针变量,传递数组的首地址)      addr(内存地址,必须是八的整数倍,可以写十进制)      num(数据个数)</span>
<span class="token comment">//出口参数：无</span>
<span class="token keyword keyword-void">void</span> <span class="token function">AT24C02_Write_Page</span><span class="token punctuation">(</span>uchar <span class="token operator">*</span> buf<span class="token punctuation">,</span>uchar addr<span class="token punctuation">,</span>uchar num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>num<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token operator">*</span>buf<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">IIC_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//函数名称：uchar AT24C02_Read(uchar addr)</span>
<span class="token comment">//函数功能：AT24C02字节读</span>
<span class="token comment">//入口参数：addr(地址)</span>
<span class="token comment">//出口参数：dat(数据)</span>
uchar <span class="token function">AT24C02_Read</span><span class="token punctuation">(</span>uchar addr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uchar dat<span class="token punctuation">;</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dat <span class="token operator">=</span> <span class="token function">IIC_RecByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendAck</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> dat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//函数名称：void AT24C02_Read_Page(uchar * buf,uchar addr,uchar num)</span>
<span class="token comment">//函数功能：AT24C02页读</span>
<span class="token comment">//入口参数：buf(指针变量,传递数组的首地址)      addr(内存地址,必须是八的整数倍,可以写十进制)      num(数据个数)</span>
<span class="token comment">//出口参数：无</span>
<span class="token keyword keyword-void">void</span> <span class="token function">AT24C02_Read_Page</span><span class="token punctuation">(</span>uchar <span class="token operator">*</span> buf<span class="token punctuation">,</span>uchar addr<span class="token punctuation">,</span>uchar num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_SendByte</span><span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IIC_WaitAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>num<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span>buf<span class="token operator">++</span> <span class="token operator">=</span> <span class="token function">IIC_RecByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
            <span class="token function">IIC_SendAck</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span>
            <span class="token function">IIC_SendAck</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">IIC_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="7串口通信">7.串口通信 </h3>
<center><img src="./gather_image/uart1.png" align="middle" width="600"></center>
<p>我们这里用定时器2来做波特率发生器，这里暂时不要求手算波特率了</p>
<center><img src="./gather_image/uart2.png" align="middle" width="600"></center>
<p>题目要求多少波特率设置多少就行，需要打开ES</p>
<p>代码示例：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uchar Uart_Rxindex<span class="token punctuation">;</span>
uchar Uart_Rxbuf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">UartInit</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>					<span class="token comment">//4800bps@12.000MHz</span>
<span class="token punctuation">{</span>
    SCON <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span>						<span class="token comment">// 8位数据,可变波特率</span>
    AUXR <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>						<span class="token comment">// 串口1选择定时器2为波特率发生器</span>
    AUXR <span class="token operator">|=</span> <span class="token number">0x04</span><span class="token punctuation">;</span>						<span class="token comment">// 定时器2时钟为Fosc, 即1T</span>
    T2L <span class="token operator">=</span> <span class="token number">0x8F</span><span class="token punctuation">;</span>						<span class="token comment">// 设定定时初值</span>
    T2H <span class="token operator">=</span> <span class="token number">0xFD</span><span class="token punctuation">;</span> 						<span class="token comment">// 设定定时初值</span>
    AUXR <span class="token operator">|=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>						<span class="token comment">// 启动定时器2</span>
    ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>									<span class="token comment">// 允许串口中断</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">Uart0</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>RI<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>Uart_Rxindex <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span>
            Uart_Rxindex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        Uart_Rxbuf<span class="token punctuation">[</span>Uart_Rxindex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> SBUF<span class="token punctuation">;</span>
        RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-char">char</span> <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span> ch<span class="token punctuation">)</span>    <span class="token comment">//使用putchar重定向后，单片机就可以用printf串口输出数据了</span>
<span class="token punctuation">{</span>
    SBUF <span class="token operator">=</span> ch<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>TI <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 等待发送完成</span>
    TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 发送完成标志位置0</span>
    <span class="token keyword keyword-return">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>常用的格式控制符：</p>
<table style="width: 100%; margin: 0 auto;">
    <tbody><tr>
        <th>格式控制符</th>
        <th>含义</th>
    </tr>
    <tr>
        <td>%d</td>
        <td>用于输出十进制整数。</td>
    </tr>
    <tr>
        <td>%f</td>
        <td>用于输出浮点数。</td>
    </tr>
    <tr>
        <td>%c</td>
        <td>用于输出字符。</td>
    </tr>
    <tr>
        <td>%s</td>
        <td>用于输出字符串。</td>
    </tr>
    <tr>
        <td>%p</td>
        <td>用于输出指针地址。</td>
    </tr>
    <tr>
        <td>%x 或 %X</td>
        <td>用于输出十六进制整数（小写或大写）。</td>
    </tr>
    <tr>
        <td>%o</td>
        <td>用于输出八进制整数。</td>
    </tr>
    <tr>
        <td>%u</td>
        <td>用于输出无符号整数。</td>
    </tr>
    <tr>
        <td>%e 或 %E</td>
        <td>用科学计数法输出浮点数（小写或大写）。</td>
    </tr>
</tbody></table>
<br>
<table style="width: 100%; margin: 0 auto;">
    <tbody><tr>
        <th>修饰符</th>
        <th>描述</th>
    </tr>
    <tr>
        <td>%nd</td>
        <td>指定输出的最小宽度（n为整数），不足部分用空格填充。</td>
    </tr>
    <tr>
        <td>%-nd</td>
        <td>左对齐输出，不足部分用空格填充。</td>
    </tr>
    <tr>
        <td>%.nf</td>
        <td>指定浮点数的小数部分位数。</td>
    </tr>
</tbody></table>在ISP打开串口助手，选好端口，设置好波特率<p></p>
<center><img src="./gather_image/uart4.png" align="middle" width="600"></center>
<hr>
<div style="page-break-after: always;"></div>
<h2 id="二常见考点">（二）常见考点 </h2>
<hr>
<h3 id="1采集量映射">1.采集量映射 </h3>
<p><strong>提示：</strong> 只要是可以采集的数据都可能考。</p>
<p><strong>映射分为两种：</strong></p>
<p><strong>（1）线性映射（y = kx+b,先求斜率，带入坐标再求b）</strong><br>
第十三届国赛：</p>
<center><img src="./gather_image/采集量映射1.png" align="middle" width="600"></center>
<p>横坐标就直接用0-255数字量就行<br>
k = 100/255.0,因为单片机非float变量除法会自动舍弃小数，当然也可以按计算器把他算出来 k = 0.39216867.</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>    <span class="token comment">//采集任务</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uchar adc<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        adc <span class="token operator">=</span> <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hum <span class="token operator">=</span> adc <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p>第十四届省赛：</p>
<center><img src="./gather_image/采集量映射2.png" align="middle" width="600"></center>
<p>k = （90-10）/（2000-200） = 8 / 180.0,因为单片机非float变量除法会自动舍弃小数，当然也可以按计算器把他算出来 k = 0.044.<br>
b = 10 - (8/180.0) * 200 用计算器计算的结果为 b = 1.112.</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>    hum <span class="token operator">=</span> fre <span class="token operator">*</span> <span class="token number">0.044</span> <span class="token operator">+</span><span class="token number">1.112</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>hum<span class="token operator">&lt;</span><span class="token number">90</span><span class="token operator">&amp;&amp;</span>hum<span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">)</span>
        有效数据
</code></pre><p><strong>（2）非线性映射</strong></p>
<p>第九届省赛：</p>
<center><img src="./gather_image/采集量映射3.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>    <span class="token comment">//采集任务</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uchar adc<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        adc <span class="token operator">=</span> <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">)</span>   level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc <span class="token operator">&gt;=</span><span class="token number">64</span> <span class="token operator">&amp;&amp;</span> adc <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span>  level <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc <span class="token operator">&gt;=</span><span class="token number">128</span> <span class="token operator">&amp;&amp;</span> adc <span class="token operator">&lt;</span> <span class="token number">1192</span><span class="token punctuation">)</span>  level <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc <span class="token operator">&gt;=</span><span class="token number">192</span> <span class="token operator">&amp;&amp;</span> adc <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">)</span>  level <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="2da输出">2.DA输出 </h3>
<p>第十三届国赛：</p>
<center><img src="./gather_image/da输出.png" align="middle" width="600"></center>
<p>分段函数，这十几年DAC只有这一种考法，DAC与各种模拟量之间的函数关系</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//采集任务</span>
<span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uchar adc<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    humidity<span class="token operator">=</span><span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x43</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.55</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>humidity<span class="token operator">==</span><span class="token number">100</span><span class="token punctuation">)</span> humidity<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">;</span>   <span class="token comment">//数码管只有两位</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>humidity<span class="token operator">&lt;</span>humidity_set<span class="token punctuation">)</span> dac<span class="token operator">=</span><span class="token number">51</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>humidity<span class="token operator">&gt;</span><span class="token number">80</span><span class="token punctuation">)</span> dac<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span> dac<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">204.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token operator">-</span>humidity_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>humidity<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">4080.0</span><span class="token operator">-</span><span class="token number">255</span><span class="token operator">*</span>humidity_set<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">80.0</span><span class="token operator">-</span>humidity_set<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PCF8591_Write</span><span class="token punctuation">(</span><span class="token number">0x43</span><span class="token punctuation">,</span>dac<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="3参数比较">3.参数比较 </h3>
<center><img src="./gather_image/参数比较.png" align="middle" width="600"></center>
<p><strong>提示：</strong> 注意我们的电压因为要显示两位小数，所以放大了一百倍，参数要显示一位小数，放大十倍，电压要和参数做比较一定要到同一数量级。</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vol <span class="token operator">/</span> <span class="token number">10.0</span>  <span class="token operator">&lt;</span> vol_parmax<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>vol <span class="token operator">/</span> <span class="token number">10.0</span>  <span class="token operator">&gt;</span> vol_parmin<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><center><img src="./gather_image/参数比较2.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>distance <span class="token operator">&gt;=</span> distance_set<span class="token operator">-</span><span class="token number">5</span> <span class="token operator">&amp;&amp;</span> distance <span class="token operator">&lt;=</span> distance_set<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span>
    alarm_count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token keyword keyword-else">else</span>
    alarm_count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>alarm_count<span class="token operator">&gt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag_alarm<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
    flag_alarm<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><center><img src="./gather_image/参数比较3.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>count_tri <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> hum <span class="token operator">&gt;</span> hum_old <span class="token operator">&amp;&amp;</span> temp <span class="token operator">&gt;</span> temp_old<span class="token punctuation">)</span>   <span class="token comment">//触发次数大于二且温湿度都升高</span>
    L6_state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword keyword-else">else</span>
    L6_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><h3 id="4触发">4.触发 </h3>
<p><strong>提示：</strong> 触发是助教写的，未经过测试，代码风格和老师有出入，但是模版用的是一样的。</p>
<p>（1）触发方式</p>
<center><img src="./gather_image/触发1.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 采集任务</span>
bit cllect_mode<span class="token punctuation">;</span> <span class="token comment">// 采集模式</span>
uchar light_value<span class="token punctuation">;</span> <span class="token comment">// 存储光敏电阻的分压值</span>
uchar light_state <span class="token operator">=</span> light_high_state<span class="token punctuation">;</span> <span class="token comment">// 光照状态，初始为亮</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">light_high_state</span> <span class="token expression"><span class="token number">1</span> </span><span class="token comment">// 光照状态亮(仅展示)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">light_low_state</span> <span class="token expression"><span class="token number">0</span> </span><span class="token comment">// 光照状态暗(仅展示)</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">collect_time</span> <span class="token expression"><span class="token number">5</span> </span><span class="token comment">// 采集时间(仅展示，实际题目中请使用变量)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">light_threshold</span>  <span class="token expression"><span class="token number">50</span> </span><span class="token comment">// 光照阈值(仅展示)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">collect_dly_num</span> <span class="token expression"><span class="token number">300</span> </span><span class="token comment">// 采集任务执行间隔（仅展示）</span></span>

<span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly <span class="token operator">&lt;</span> collect_dly_num<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">ds1302_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从DS1302读取时间</span>
    light_value <span class="token operator">=</span> <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取光敏电阻的值（如果题目要求在触发模式下才读取光敏电阻的值，则需要修改）</span>

    <span class="token keyword keyword-switch">switch</span><span class="token punctuation">(</span>cllect_mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token comment">// 定时模式</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> collect_time <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//执行采集任务      </span>
            <span class="token punctuation">}</span> 
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token comment">// 触发模式</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>light_value <span class="token operator">&lt;</span> light_threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 光照值小于阈值</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>light_state <span class="token operator">==</span> light_high_state<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果之前是亮状态</span>
                    light_state <span class="token operator">=</span> light_low_state<span class="token punctuation">;</span> <span class="token comment">// 更新为暗状态</span>
                    <span class="token comment">//执行采集任务</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                light_state <span class="token operator">=</span> light_high_state<span class="token punctuation">;</span> <span class="token comment">// 更新为亮状态</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>（2）触发计数</p>
<center><img src="./gather_image/触发4.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 采集任务</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">high_state</span> <span class="token expression"><span class="token number">1</span> </span><span class="token comment">// 通道3状态高电平(仅展示,方便理解)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">low_state</span> <span class="token expression"><span class="token number">0</span> </span><span class="token comment">// 通道3状态低电平(仅展示,方便理解)</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Voltage_threshold</span> <span class="token expression"><span class="token number">100</span> </span><span class="token comment">// 电压阈值(仅展示，方便理解)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">collect_dly_num</span> <span class="token expression"><span class="token number">300</span> </span><span class="token comment">// 采集任务执行间隔（仅展示，方便理解）</span></span>

uchar adc_value<span class="token punctuation">;</span> <span class="token comment">// 存储电阻的分压值</span>
uchar AIN3_state <span class="token operator">=</span> high_state<span class="token punctuation">;</span> <span class="token comment">// 通道3状态，初始为高电压</span>
uchar state_change_count  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 状态改变计数</span>

<span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly <span class="token operator">&lt;</span> collect_dly_num<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    adc_value <span class="token operator">=</span> <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取电阻的分压值</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc_value <span class="token operator">&lt;</span> Voltage_threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 电阻分压值小于阈值</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>AIN3_state <span class="token operator">==</span> high_state<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果之前是高电平状态</span>
            AIN3_state <span class="token operator">=</span> low_state<span class="token punctuation">;</span> <span class="token comment">// 更新为低电平状态</span>
            state_change_count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        AIN3_state <span class="token operator">=</span> high_state<span class="token punctuation">;</span> <span class="token comment">// 更新为高电平状态</span>
    <span class="token punctuation">}</span>
   
<span class="token punctuation">}</span>
</code></pre><p>（3）触发记录数据</p>
<center><img src="./gather_image/触发3.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 采集任务</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">normal_state</span> <span class="token expression"><span class="token number">2</span> </span><span class="token comment">// 通道3状态正常</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">high_state</span> <span class="token expression"><span class="token number">1</span> </span><span class="token comment">// 通道3状态高电压</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">low_state</span> <span class="token expression"><span class="token number">0</span> </span><span class="token comment">// 通道3状态低电压</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Low_Voltage</span> <span class="token expression"><span class="token number">50</span> </span><span class="token comment">// 低电压阈值</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">High_Voltage</span> <span class="token expression"><span class="token number">150</span> </span><span class="token comment">// 高电压阈值</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">collect_dly_num</span> <span class="token expression"><span class="token number">300</span> </span><span class="token comment">// 采集任务执行间隔</span></span>

uchar adc_value<span class="token punctuation">;</span> <span class="token comment">// 存储电阻的分压值</span>
uchar AIN3_state <span class="token operator">=</span> normal_state<span class="token punctuation">;</span> <span class="token comment">// 通道3状态，初始为正常状态</span>

<span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly <span class="token operator">&lt;</span> collect_dly_num<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">ds1302_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从DS1302读取时间</span>
    adc_value <span class="token operator">=</span> <span class="token function">PCF8591_Read</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取电阻的分压值</span>

    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc_value <span class="token operator">&gt;</span> High_Voltage<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 电压高于高电压阈值</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>AIN3_state <span class="token operator">!=</span> high_state<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果之前不是高电平状态</span>
            AIN3_state <span class="token operator">=</span> high_state<span class="token punctuation">;</span> <span class="token comment">// 更新为高电平状态</span>
            state_change_count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token comment">// 记录时间和事件类型</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>adc_value <span class="token operator">&lt;</span> Low_Voltage<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 电压低于低电压阈值</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>AIN3_state <span class="token operator">!=</span> low_state<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果之前不是低电平状态</span>
            AIN3_state <span class="token operator">=</span> low_state<span class="token punctuation">;</span> <span class="token comment">// 更新为低电平状态</span>
            state_change_count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token comment">// 记录时间和事件类型</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span> <span class="token comment">// 电压在正常范围内</span>
        AIN3_state <span class="token operator">=</span> normal_state<span class="token punctuation">;</span> <span class="token comment">// 更新为正常状态</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="5数据回显">5.数据回显 </h3>
<center><img src="./gather_image/数据回显.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 采集任务</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">collect_dly_num</span> <span class="token expression"><span class="token number">300</span> </span><span class="token comment">// 采集任务执行间隔</span></span>

uchar distance<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 存储距离值</span>
uchar index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 存储距离值的索引(编号为索引加1)</span>

<span class="token keyword keyword-void">void</span> <span class="token function">collect_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>collect_dly <span class="token operator">&lt;</span> collect_dly_num<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    collect_dly <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    distance<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">read_distance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    index<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="6最值-平均值">6.最值、平均值 </h3>
<p>第十二届国赛：</p>
<center><img src="./gather_image/最值、平均值.png" align="middle" width="600"></center>
<p><strong>求平均值：</strong> 每次采集的数据求和/count (如果题目要显示一位小数，那么每次采集的数据求和*10/count)</p>
<p><strong>最大值：</strong> 每次采到的数据和之前的最大值作比较，如果比最大值大就把新采到的数据赋给最大值</p>
<p><strong>最小值：</strong> 每次采到的数据和之前的最小值作比较，如果比最小值小就把新采到的数据赋给最小值</p>
<p>c复制</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>distance_max <span class="token operator">=</span> <span class="token punctuation">(</span>distance<span class="token operator">&gt;</span>distance_max<span class="token punctuation">)</span> <span class="token operator">?</span> distance <span class="token operator">:</span> distance_max<span class="token punctuation">;</span>
distance_min <span class="token operator">=</span> <span class="token punctuation">(</span>distance<span class="token operator">&lt;</span>distance_min<span class="token punctuation">)</span> <span class="token operator">?</span> distance <span class="token operator">:</span>distance_min<span class="token punctuation">;</span>
distance_sum <span class="token operator">=</span> distance <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> distance_sum<span class="token punctuation">;</span>   <span class="token comment">//在显示的时候除count,就可以保留一位小数</span>
</code></pre><h3 id="7数据召测">7.数据召测 </h3>
<p>第十届国赛：</p>
<center><img src="./gather_image/数据召测.png" align="middle" width="600"></center>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">uart_pro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>index<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>uart_stick<span class="token operator">&gt;=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment">//  </span>
    <span class="token punctuation">{</span>
        uart_stick<span class="token operator">=</span>uart_flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>index<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>index<span class="token operator">==</span><span class="token number">4</span><span class="token operator">||</span>index<span class="token operator">==</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>rec_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'S'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'T'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'\r'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'\n'</span><span class="token punctuation">)</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"$%2d,%.2f\r\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>distance<span class="token punctuation">,</span>temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>rec_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'P'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'A'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'R'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'A'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'\r'</span><span class="token operator">&amp;&amp;</span>rec_buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'\n'</span><span class="token punctuation">)</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#%2d,%2d\r\n"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>distance_set<span class="token punctuation">,</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>temperature_set<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-else">else</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>

      </div>
      <div class="md-sidebar-toc">
<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#前言" class="md-toc-link">
            <p>前言</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#一-数码管相关考点总结" class="md-toc-link"><p>一、数码管相关考点总结</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#一数码管控制代码" class="md-toc-link">
            <p>（一）数码管控制代码</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#二数码管考点分析" class="md-toc-link"><p>（二）数码管考点分析</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-显示数字" class="md-toc-link">
            <ol>
<li>显示数字</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-显示小数点" class="md-toc-link">
            <ol start="2">
<li>显示小数点</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-显示特殊字符" class="md-toc-link">
            <ol start="3">
<li>显示特殊字符</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-多界面" class="md-toc-link">
            <ol start="4">
<li>多界面</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-数码管闪烁" class="md-toc-link">
            <ol start="5">
<li>数码管闪烁</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-高位熄灭" class="md-toc-link">
            <ol start="6">
<li>高位熄灭</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7-负数显示" class="md-toc-link">
            <ol start="7">
<li>负数显示</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#8-单位切换" class="md-toc-link">
            <ol start="8">
<li>单位切换</li>
</ol>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#二-led相关考点总结" class="md-toc-link"><p>二、LED相关考点总结</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#一led控制代码" class="md-toc-link">
            <p>（一）LED控制代码</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#二led考点分析" class="md-toc-link"><p>（二）LED考点分析</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-流水灯" class="md-toc-link">
            <ol>
<li>流水灯</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-pwm流水灯" class="md-toc-link">
            <ol start="2">
<li>PWM流水灯</li>
</ol>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3-led闪烁以x秒为间隔闪烁指的是亮和灭的时间间隔" class="md-toc-link"><ol start="3">
<li>LED闪烁（以x秒为间隔闪烁指的是亮和灭的时间间隔）</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#题目一" class="md-toc-link">
            <p>题目一</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#题目二" class="md-toc-link">
            <p>题目二</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4-led亮一定时间后熄灭" class="md-toc-link"><ol start="4">
<li>LED亮一定时间后熄灭</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#题目一-1" class="md-toc-link">
            <p>题目一</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#题目二-1" class="md-toc-link">
            <p>题目二</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-状态指示灯" class="md-toc-link">
            <ol start="5">
<li>状态指示灯</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-二进制灯" class="md-toc-link">
            <ol start="6">
<li>二进制灯</li>
</ol>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#三-按键考点总结" class="md-toc-link"><p>三、按键考点总结</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#一按键底层代码" class="md-toc-link">
            <p>（一）按键底层代码</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#二按键触发方式近几年-s4-s5-s8-s9-考频很高就以这四个按键为例" class="md-toc-link"><p>(二)按键触发方式（近几年 S4、S5、S8、S9 考频很高，就以这四个按键为例）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-按下生效-松手生效" class="md-toc-link">
            <ol>
<li>按下生效、松手生效</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-短按-长按生效" class="md-toc-link">
            <ol start="2">
<li>短按、长按生效</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-双按键" class="md-toc-link">
            <ol start="3">
<li>双按键</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-双击" class="md-toc-link">
            <ol start="4">
<li>双击</li>
</ol>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#5-组合按键根据排列组合大概有二十一种组合方式一定要灵活使用" class="md-toc-link"><ol start="5">
<li>组合按键（根据排列组合，大概有二十一种组合方式，一定要灵活使用）</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1短按和长按松手" class="md-toc-link">
            <p>（1）短按和长按松手</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2双按键长按" class="md-toc-link">
            <p>（2）双按键长按</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#三按键功能" class="md-toc-link"><p>（三）按键功能</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-状态切换" class="md-toc-link">
            <ol>
<li>状态切换</li>
</ol>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2-参数调整" class="md-toc-link"><ol start="2">
<li>参数调整</li>
</ol>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1是否退出参数界面生效题目一定会说明不说明就默认设置时生效" class="md-toc-link">
            <p>（1）是否退出参数界面生效(题目一定会说明，不说明就默认设置时生效)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2边界值限制题目一定会说明不说明就默认参数加-减到最值时不会再加-减" class="md-toc-link">
            <p>（2）边界值限制(题目一定会说明，不说明就默认参数加、减到最值时不会再加、减)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3检查参数合理性" class="md-toc-link">
            <p>（3）检查参数合理性</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4参数非线性调节" class="md-toc-link">
            <p>（4）参数非线性调节</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-多界面" class="md-toc-link">
            <ol start="3">
<li>多界面</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4-切换选中单元" class="md-toc-link">
            <ol start="4">
<li>切换选中单元</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5-键盘输入" class="md-toc-link">
            <ol start="5">
<li>键盘输入</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6-按键禁用" class="md-toc-link">
            <ol start="6">
<li>按键禁用</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7-任意按键生效" class="md-toc-link">
            <ol start="7">
<li>任意按键生效</li>
</ol>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#四-蜂鸣器-继电器-电机考点总结" class="md-toc-link"><p>四、蜂鸣器、继电器、电机考点总结</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#一继电器蜂鸣器电机底层代码" class="md-toc-link">
            <p>（一）继电器蜂鸣器电机底层代码</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#二考点分析前两者考点均为状态控制电机为pwm" class="md-toc-link"><p>（二）考点分析（前两者考点均为状态控制，电机为PWM）</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1-继电器" class="md-toc-link">
            <ol>
<li>继电器</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2-蜂鸣器" class="md-toc-link">
            <ol start="2">
<li>蜂鸣器</li>
</ol>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3-电机" class="md-toc-link">
            <ol start="3">
<li>电机</li>
</ol>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#五-采集任务考点总结" class="md-toc-link"><p>五、采集任务考点总结</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#一采集模块总结" class="md-toc-link"><p>（一）采集模块总结</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1ds18b20" class="md-toc-link">
            <p>1.ds18b20</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2ds1302" class="md-toc-link">
            <p>2.ds1302</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3ne555" class="md-toc-link">
            <p>3.NE555</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4pcf8591" class="md-toc-link"><p>4.PCF8591</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#adc" class="md-toc-link">
            <p>ADC</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#dac" class="md-toc-link">
            <p>DAC</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5超声波" class="md-toc-link">
            <p>5.超声波</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6at24c02" class="md-toc-link">
            <p>6.AT24C02</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7串口通信" class="md-toc-link">
            <p>7.串口通信</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#二常见考点" class="md-toc-link"><p>（二）常见考点</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#1采集量映射" class="md-toc-link">
            <p>1.采集量映射</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#2da输出" class="md-toc-link">
            <p>2.DA输出</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#3参数比较" class="md-toc-link">
            <p>3.参数比较</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4触发" class="md-toc-link">
            <p>4.触发</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#5数据回显" class="md-toc-link">
            <p>5.数据回显</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#6最值-平均值" class="md-toc-link">
            <p>6.最值、平均值</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#7数据召测" class="md-toc-link">
            <p>7.数据召测</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
</div>
</div>
      <a id="sidebar-toc-btn">≡</a>
    
    
    
    
    
    
<script>
document.body.setAttribute('html-show-sidebar-toc', true)
var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>